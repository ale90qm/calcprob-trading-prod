server {
    # Nginx escuchará en el puerto 80 dentro del contenedor.
    listen 80;
    # El nombre del servidor (no es crucial en esta configuración).
    server_name localhost;

    # La raíz de los archivos web, debe coincidir con la de PHP-FPM.
    root /var/www/html;
    # Archivo por defecto a buscar.
    index index.php index.html;

    # Regla para manejar todas las peticiones.
    # Intenta encontrar el archivo o directorio solicitado; si no existe,
    # pasa la petición a index.php.
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Regla para manejar específicamente los archivos .php.
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;

        # La directiva más importante: Pasa la ejecución del script
        # al servicio llamado 'app' (nuestro contenedor PHP-FPM)
        # en el puerto 9000 (el puerto estándar de FPM).
        fastcgi_pass app:9000;
        
        fastcgi_index index.php;
        include fastcgi_params;
        # Le dice a PHP-FPM la ruta exacta del script que debe ejecutar.
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}